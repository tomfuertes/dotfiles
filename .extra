# TomF Specific brews and startup installs
function custom-brew-install() {
  # cat ~/.zshrc and run those
  mkdir -p "$HOME/.zsh"

  # download + install homebrew
  brew install oven-sh/bun/bun
  brew install gh
  brew tap heroku/brew && brew install heroku
  brew install jq
  brew uninstall node
  brew install redis
  brew install the_silver_searcher
  brew install wget
  brew install z

  brew install rbenv ruby-build

  # Assuming ZSH
  mkdir -p "$HOME/.zsh"
  git clone https://github.com/sindresorhus/pure.git "$HOME/.zsh/pure"
}

alias pip=/opt/homebrew/bin/pip3
alias python=/opt/homebrew/bin/python3

# Git credentials
# Not in the repository, to prevent people from accidentally committing under my name
GIT_AUTHOR_NAME="tomfuertes"
GIT_COMMITTER_NAME="$GIT_AUTHOR_NAME"
git config --global user.name "$GIT_AUTHOR_NAME"
GIT_AUTHOR_EMAIL="tomfuertes@gmail.com"
GIT_COMMITTER_EMAIL="$GIT_AUTHOR_EMAIL"
git config --global user.email "$GIT_AUTHOR_EMAIL"

# Not a config for this but don't want to edit merge messages locally
export GIT_MERGE_AUTOEDIT=no

git config --global push.default current
git config --global branch.autosetuprebase always
git config --global push.autoSetupRemote true
git config --global fetch.prune true # http://stackoverflow.com/a/8255687/94668
git config --global pull.rebase true
git config --global alias.st status
git config --global alias.ci commit
git config --global commit.gpgsign true
git config --global user.signingkey ~/.ssh/id_ed25519.pub
eval "$(ssh-agent -s)"
ssh-add --apple-use-keychain ~/.ssh/id_ed25519
git config --global gpg.format ssh
git config --global merge.ff no

# Add Visual Studio Code (code)
export PATH="$PATH:/Applications/Visual Studio Code.app/Contents/Resources/app/bin"

# ulimit
ulimit -n 2560

# minor aliases
alias ll="la -h"

# brew install z.sh
alias j=z
. $(brew --prefix)/etc/profile.d/z.sh

# http://stackoverflow.com/a/26803738/94668
alias prune='git branch --merged | grep -v "\*" | egrep -v "master\|development" | xargs -n 1 git branch -d'

# subl -> code
# alias code="cursor"
alias subl=code
alias cursor=code
export EDITOR='code -w'

# Larger bash history (default is 500)
export HISTSIZE=10000000
export SAVEHIST=10000000
setopt BANG_HIST              # Treat the '!' character specially during expansion.
setopt EXTENDED_HISTORY       # Write the history file in the ":start:elapsed;command" format.
setopt INC_APPEND_HISTORY     # Write to the history file immediately, not when the shell exits.
setopt SHARE_HISTORY          # Share history between all sessions.
setopt HIST_EXPIRE_DUPS_FIRST # Expire duplicate entries first when trimming history.
setopt HIST_IGNORE_DUPS       # Don't record an entry that was just recorded again.
setopt HIST_IGNORE_ALL_DUPS   # Delete old recorded entry if new entry is a duplicate.
setopt HIST_FIND_NO_DUPS      # Do not display a line previously found.
setopt HIST_IGNORE_SPACE      # Don't record an entry starting with a space.
setopt HIST_SAVE_NO_DUPS      # Don't write duplicate entries in the history file.
setopt HIST_REDUCE_BLANKS     # Remove superfluous blanks before recording entry.
setopt HIST_VERIFY            # Don't execute immediately upon history expansion.
setopt HIST_BEEP              # Beep when accessing nonexistent history.

alias clean='find . -name "*.pyc" -delete; find . -name ".DS_Store" -delete; if [ -d .git ]; then git clean -fdx -- tmp; fi;'

### NOTICES ###
# Notice title
notice() { echo -e "\033[1;32m=> $1\033[0m"; }
# Notice title
msg() { echo -e "\033[1;34m=> $1\033[0m"; }
# Error title
error() { echo -e "\033[1;31m=> Error: $1\033[0m"; }
# List item
c_list() { echo -e "  \033[1;32m✔\033[0m $1"; }
# Error list item
e_list() { echo -e "  \033[1;31m✖\033[0m $1"; }

# Update Helpers
alias brup="brew update; brew upgrade; brew cleanup"
# alias hlt="heroku logs --tail"
# alias hltr="heroku logs --tail -n 1000 -r heroku"
# alias hlts="heroku logs --tail -n 1000 -r staging"

function udf() {
  git checkout -b update-deps-$(date +%Y-%m-%d)
  npx npm-check-updates -u --interactive
  git add package*
  git commit -m "npm run update-deps"
  git push --no-verify
  gh pr create
  npm run reset
  npm run audit
}

alias c="clear"
alias G="gh browse"

alias taillog="tail -n 50 -f log/development.log"
alias tailog="taillog"

alias b="npx bun"

zipall() {
  local ts=$(date +%Y%m%d)

  for d in ./*(/N); do
    echo "Archiving: ${d:t} → ${d:t}-${ts}.tgz"

    tar -czf "${d:t}-${ts}.tgz" \
      --exclude="node_modules" \
      "$d"
  done
}
